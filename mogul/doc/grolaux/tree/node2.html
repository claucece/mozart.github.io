<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>2 Tutorial Example : a simple word processing application</TITLE><LINK href="ozdoc.css" rel="stylesheet" type="text/css"></HEAD><BODY><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node1.html#chapter.introduction">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node3.html#chapter.reference">Next &gt;&gt;</A></TD></TR></TABLE><DIV id="chapter.example"><H1><A name="chapter.example">2 Tutorial Example : a simple word processing application</A></H1><P>The following examples describes how to use the <CODE>TreeNode</CODE> class with Tk and QTk. The last example shows how an application can take full control over the tree. </P><H2><A name="label1">2.1 Example using the Tk module</A></H2><P></P><BLOCKQUOTE class="code"><CODE><SPAN class="keyword">declare</SPAN>&nbsp;<BR>[Tree]={Module<SPAN class="keyword">.</SPAN>link&nbsp;[<SPAN class="string">&quot;Tree.ozf&quot;</SPAN>]}<BR>TreeNode=Tree<SPAN class="keyword">.</SPAN>treeNode<BR>T={New&nbsp;Tk<SPAN class="keyword">.</SPAN>toplevel&nbsp;tkInit}<BR>C={New&nbsp;Tk<SPAN class="keyword">.</SPAN>canvas&nbsp;tkInit(parent:T)}<BR>{Tk<SPAN class="keyword">.</SPAN>send&nbsp;pack(C)}<BR>RootNode={New&nbsp;TreeNode&nbsp;init(canvas:C<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font:<SPAN class="string">&quot;Helvetica&nbsp;10&quot;</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height:18<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:<SPAN class="string">&quot;Node&quot;</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}<BR>{RootNode&nbsp;draw(x:2&nbsp;y:2&nbsp;height:_)}<BR>&nbsp;<BR><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">AddNodes</SPAN>&nbsp;Node&nbsp;Nu}<BR>&nbsp;&nbsp;&nbsp;Label={Node&nbsp;get(label:$)}<BR><SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;{List<SPAN class="keyword">.</SPAN>forAllInd&nbsp;{List<SPAN class="keyword">.</SPAN>make&nbsp;Nu}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">$</SPAN>&nbsp;I&nbsp;_}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewNode={New&nbsp;TreeNode&nbsp;init(parent:Node<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:Label<SPAN class="keyword">#</SPAN><SPAN class="string">&quot;&nbsp;&quot;</SPAN><SPAN class="keyword">#</SPAN>I)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Node&nbsp;addLeaf(node:NewNode)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{AddChildren&nbsp;NewNode&nbsp;Nu<SPAN class="keyword">-</SPAN>1}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>}<BR><SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>{AddNodes&nbsp;RootNode&nbsp;5}<BR>{RootNode&nbsp;expand}</CODE></BLOCKQUOTE><P> The root node of the tree is an instance of <CODE>TreeNode</CODE> where the canvas parameter has been set. As shown in the example, a font can be specified by the <CODE>font</CODE> parameter. Each node of the tree will take the height that is the height of the font used to display the label of node, unless the <CODE>height</CODE> parameter force another value. The label parameter sets the text displayed in the node.</P><P>Once the root node is created, it is not yet shown in the canvas. You must explicitly specify where you want to display this node the calling the method <CODE>show</CODE>, hence : </P><BLOCKQUOTE class="code"><CODE>{RootNode&nbsp;draw(x:2&nbsp;y:2&nbsp;height:_)}</CODE></BLOCKQUOTE><P> The tree parameters <CODE>x</CODE>, <CODE>y</CODE> and <CODE>height</CODE> are required. The first two corresponds to the position where to place the top left corner of the node. The <CODE>height</CODE> parameter binds the specified variable to the height taken to draw the whole node (including subnodes if needed). In this case, this value can be ignored, hence <CODE>_</CODE>.</P><P>The procedure <CODE>AddNodes</CODE> recursively add nodes to a node. Adding a node is done in two steps : </P><UL><LI><P>Creating a new instance of the <CODE>TreeNode</CODE> class. The initialisation parameters are somewhat different from the root node. The <CODE>parent</CODE> parameter specifies the parent node. The <CODE>canvas</CODE>, <CODE>font</CODE> and <CODE>height</CODE> parameters of the root node of the tree <EM>MUST NOT</EM> and <EM>CAN'T</EM> be specified for all other nodes of the tree. The font and height used by nodes are therefore the same for the whole tree.</P></LI><LI><P>Adding the new created node to the parent node. This is done by calling the <CODE>addLeaf</CODE> method of the parent node : <CODE>{Node&nbsp;addLeaf(node:NewNode)}</CODE>.</P></LI></UL><P> </P><H2><A name="label2">2.2 Example using the QTk module</A></H2><P></P><BLOCKQUOTE class="code"><CODE><SPAN class="keyword">declare</SPAN>&nbsp;<BR>[Tree&nbsp;QTk]={Module<SPAN class="keyword">.</SPAN>link&nbsp;[<SPAN class="string">&quot;Tree.ozf&quot;</SPAN>&nbsp;<SPAN class="string">&quot;http://www.info.ucl.ac.be/people/ned/qtk/QTk.ozf&quot;</SPAN>]}<BR>TreeNode=Tree<SPAN class="keyword">.</SPAN>treeNode<BR>C<BR>{{QTk<SPAN class="keyword">.</SPAN>build&nbsp;td(canvas(glue:nswe<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handle:C<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tdscrollbar:<SPAN class="keyword">true</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lrscrollbar:<SPAN class="keyword">true</SPAN>))}&nbsp;show}<BR>&nbsp;<BR>RootNode={New&nbsp;TreeNode&nbsp;init(canvas:C<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font:{QTk<SPAN class="keyword">.</SPAN>newFont&nbsp;font(family:<SPAN class="string">&quot;Helvetica&quot;</SPAN>&nbsp;size:10)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height:18<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:<SPAN class="string">&quot;Node&quot;</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}<BR>{RootNode&nbsp;draw(x:2&nbsp;y:2&nbsp;height:_)}<BR>&nbsp;<BR><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">AddChildren</SPAN>&nbsp;Node&nbsp;Nu}<BR>&nbsp;&nbsp;&nbsp;Label={Node&nbsp;get(label:$)}<BR><SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;{List<SPAN class="keyword">.</SPAN>forAllInd&nbsp;{List<SPAN class="keyword">.</SPAN>make&nbsp;Nu}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">$</SPAN>&nbsp;I&nbsp;_}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewNode={New&nbsp;TreeNode&nbsp;init(parent:Node<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:Label<SPAN class="keyword">#</SPAN><SPAN class="string">&quot;&nbsp;&quot;</SPAN><SPAN class="keyword">#</SPAN>I)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Node&nbsp;addLeaf(node:NewNode)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{AddChildren&nbsp;NewNode&nbsp;Nu<SPAN class="keyword">-</SPAN>1}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>}<BR><SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>{AddChildren&nbsp;RootNode&nbsp;5}<BR>{RootNode&nbsp;expand}</CODE></BLOCKQUOTE><P> As shown in this example, only the way of building the window is changed. Warning : there is no parameter checking in the <CODE>TreeNode</CODE> as is in QTk. If you use an invalid value for the underlying toolkit, the error will not be raised at the Oz level, but will appear at the standard error as a Tcl/Tk error.</P><H2><A name="label3">2.3 Advanced interactions</A></H2><P>This example will show how to bind events to user clicks on the nodes, how to manage a selection rectangle and how to make to tree be calculated lazily as the user expands the different nodes. </P><BLOCKQUOTE class="code"><CODE><SPAN class="keyword">declare</SPAN>&nbsp;<BR>[Tree&nbsp;QTk]={Module<SPAN class="keyword">.</SPAN>link&nbsp;[<SPAN class="string">&quot;Tree.ozf&quot;</SPAN>&nbsp;<SPAN class="string">&quot;http://www.info.ucl.ac.be/people/ned/qtk/QTk.ozf&quot;</SPAN>]}<BR>TreeNode=Tree<SPAN class="keyword">.</SPAN>treeNode<BR>C<BR>{{QTk<SPAN class="keyword">.</SPAN>build&nbsp;td(canvas(glue:nswe<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handle:C<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tdscrollbar:<SPAN class="keyword">true</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lrscrollbar:<SPAN class="keyword">true</SPAN>))}&nbsp;show}<BR>&nbsp;<BR>&nbsp;<BR><SPAN class="keyword">class</SPAN>&nbsp;<SPAN class="type">CustomNode</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">from</SPAN><SPAN class="type">&nbsp;TreeNode</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">feat</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calc<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current:{NewCell&nbsp;<SPAN class="keyword">unit</SPAN>}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">meth</SPAN>&nbsp;<SPAN class="functionname">init</SPAN>(<SPAN class="keyword">...</SPAN>)=M<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TreeNode<SPAN class="keyword">,</SPAN>M<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<SPAN class="keyword">self</SPAN>&nbsp;bind(event:<SPAN class="string">&quot;&lt;1&gt;&quot;</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action:<SPAN class="keyword">self#</SPAN>SelectNode)}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">meth</SPAN>&nbsp;<SPAN class="functionname">SelectNode</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">if</SPAN>&nbsp;{Access&nbsp;<SPAN class="keyword">self.</SPAN>current}<SPAN class="keyword">\=unit</SPAN>&nbsp;<SPAN class="keyword">then</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{Access&nbsp;<SPAN class="keyword">self.</SPAN>current}&nbsp;select(state:<SPAN class="keyword">false</SPAN>)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">if</SPAN>&nbsp;{Access&nbsp;<SPAN class="keyword">self.</SPAN>current}<SPAN class="keyword">==self</SPAN>&nbsp;<SPAN class="keyword">then</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<SPAN class="keyword">self</SPAN>&nbsp;switch}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Assign&nbsp;<SPAN class="keyword">self.</SPAN>current&nbsp;<SPAN class="keyword">self</SPAN>}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<SPAN class="keyword">self</SPAN>&nbsp;select(state:<SPAN class="keyword">true</SPAN>)}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">meth</SPAN>&nbsp;<SPAN class="functionname">expand</SPAN>(<SPAN class="keyword">...</SPAN>)=M<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">if</SPAN>&nbsp;{IsFree&nbsp;<SPAN class="keyword">self.</SPAN>calc}&nbsp;<SPAN class="keyword">then</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Label={<SPAN class="keyword">self</SPAN>&nbsp;get(label:$)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<SPAN class="keyword">self</SPAN>&nbsp;addLeaf(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nodes:{List<SPAN class="keyword">.</SPAN>map&nbsp;[<SPAN class="string">&quot;a&quot;</SPAN>&nbsp;<SPAN class="string">&quot;b&quot;</SPAN>&nbsp;<SPAN class="string">&quot;c&quot;</SPAN>&nbsp;<SPAN class="string">&quot;d&quot;</SPAN>]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">fun</SPAN>{<SPAN class="functionname">$</SPAN>&nbsp;C}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{New&nbsp;CustomNode&nbsp;init(parent:<SPAN class="keyword">self</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:Label<SPAN class="keyword">#</SPAN><SPAN class="string">&quot;&nbsp;&quot;</SPAN><SPAN class="keyword">#</SPAN>C)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>})}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">self.</SPAN>calc=<SPAN class="keyword">unit</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TreeNode<SPAN class="keyword">,</SPAN>M<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;<BR><SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;<BR>CurrentNode={NewCell&nbsp;<SPAN class="keyword">unit</SPAN>}<BR>&nbsp;<BR>RootNode={New&nbsp;CustomNode&nbsp;init(canvas:C<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font:<SPAN class="string">&quot;Helvetica&nbsp;10&quot;</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height:18<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label:<SPAN class="string">&quot;Node&quot;</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}<BR>&nbsp;<BR>{RootNode&nbsp;draw(x:2&nbsp;y:2&nbsp;height:_)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>{RootNode&nbsp;expand}</CODE></BLOCKQUOTE><P> Overloading the <CODE>TreeNode</CODE> class allows to take full control of the tree. The <CODE>bind</CODE> call in the <CODE>init</CODE> method defines a method to be called when the user left clicks on the node. A node can be marked as selected by calling the method <CODE>select(state:<SPAN class="keyword">true</SPAN>)</CODE>. <CODE>CustomNode</CODE> uses a shared feature called <CODE>current</CODE> to store which node is currently selected. The <CODE>selectNode</CODE> method, that is called when the user clicks on the node, checks to see if a node was previously selected to remove its selection rectangle (<CODE>select(state:<SPAN class="keyword">false</SPAN>)</CODE>), and mark the clicked node as selected, storing this information in <CODE><SPAN class="keyword">self.</SPAN>current</CODE>. Moreover, if the user clicks several times the same node, it automatically switch between the states expanded and collapsed thanks to a call to the <CODE>switch</CODE> method.</P><P>The <CODE>expand</CODE> method is overloaded so that children nodes are computed on-the-fly. The first time the node tries to expand itself, the <CODE>calc</CODE> feature is not yet bound. The children are then computed and added and <CODE>calc</CODE> is bound to <CODE><SPAN class="keyword">unit</SPAN></CODE>.</P></DIV><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node1.html#chapter.introduction">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node3.html#chapter.reference">Next &gt;&gt;</A></TD></TR></TABLE><HR><ADDRESS>Donatien Grolaux<BR><SPAN class="version">Version 1.1.1 (20000613)</SPAN></ADDRESS></BODY></HTML>
