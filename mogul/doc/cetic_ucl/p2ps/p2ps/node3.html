<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>3 Message and Event Streams</TITLE><LINK href="ozdoc.css" rel="stylesheet" type="text/css"></HEAD><BODY><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node2.html#chapter.p2ps_api">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node4.html#chapter.examples">Next &gt;&gt;</A></TD></TR></TABLE><DIV id="chapter.eventsmessages"><H1><A name="chapter.eventsmessages">3 Message and Event Streams</A></H1><DIV id="section.eventsmessages.messages"><H2><A name="section.eventsmessages.messages">3.1  Message stream</A></H2><P>Since <CODE>P2PS</CODE> provides asynchronous message sending, the messages are available on a message stream, as they are received. One can access the message stream with the methods <CODE>getMsgStrm</CODE>, <CODE>createNet</CODE> and <CODE>joinNet</CODE> of class <CODE>P2PServices</CODE> (see <A href="node2.html#section.p2ps.p2pservices">Section&nbsp;2.1</A>). Each message is wrapped into a record of the following form: </P><BLOCKQUOTE class="code"><CODE>rcvMsg(src:Src&nbsp;dst:Dst&nbsp;msg:Msg)</CODE></BLOCKQUOTE><P> <CODE><I>Msg</I></CODE> is the message itself, as it was sent with the communication primitives of class <CODE>P2PServices</CODE>. <CODE><I>Src</I></CODE> denotes the source of the message, i.e., the Id of the node that initiated the send. <CODE><I>Dst</I></CODE> denotes the destination of the message. It designates either the node whose Id is equal with <CODE><I>Dst</I></CODE>, or the node which is responsible for the key equal to <CODE><I>Dst</I></CODE>. The former case applies when the message was intended to the node whose Id is equal to <CODE><I>Dst</I></CODE>, whereas th latter applies when the message was intended to the responsible of key equal to <CODE><I>Dst</I></CODE>. </P></DIV><DIV id="section.eventsmessages.events"><H2><A name="section.eventsmessages.events">3.2  Event stream</A></H2><P>The events represent asynchronous actions that occur in <CODE>P2PS</CODE>. They are available on the event stream (see the methods <CODE>getEvntStrm</CODE>, <CODE>createNet</CODE> and <CODE>joinNet</CODE> of class <CODE>P2PServices</CODE> in <A href="node2.html#section.p2ps.p2pservices">Section&nbsp;2.1</A>). An application can watch the events and react accordingly. In the following we enumerate the supported events. </P><DL><DT><CODE>alone</CODE> </DT><DD><P>Issued when the node remains alone in the network. </P></DD><DT><CODE>connected</CODE> </DT><DD><P>Issued when the node becomes connected to a <CODE>P2PS</CODE> network. This event has the form <CODE>connected(useProxy:B)</CODE>, where <CODE><I>B</I></CODE> is a boolean indicating whether the node can be (<CODE><SPAN class="keyword">false</SPAN></CODE>) or not (<CODE><SPAN class="keyword">true</SPAN></CODE>) accessed directly by other nodes in the network. In the latter case, the node uses its successor as a proxy to be part of the network. </P></DD><DT><CODE>new</CODE> </DT><DD><P>Issued when there is a change in the connections of this node, i.e., new successor, predecessor, finger table, or successor list. The event has the form of a record with label <CODE>new</CODE>. For now, the record has only one feature denoting the event subtype. Below we enumerate the possible subtypes and the form of their corresponding values. </P><DL><DT><CODE>new(ft:FT)</CODE> </DT><DD><P>Issued when the finger table (i.e., the set of neighbors) of this node has changed. <CODE><I>FT</I></CODE> has the form of a record with label <CODE>ft</CODE>. The record contains the node Ids of the fingers. The maximum number of fingers at a node depends on the maximum network size of the system (see <CODE>NetConfig</CODE> in <A href="node2.html#section.p2ps.p2pservices">Section&nbsp;2.1</A>). For the positions for which the value of a finger is determined, its node Id is provided, otherwise <CODE><SPAN class="keyword">unit</SPAN></CODE> is provided. </P></DD><DT><CODE>new(pred:Pred)</CODE> </DT><DD><P>Issued when the node has a new predecessor node. <CODE><I>Pred</I></CODE> represents the node Id of the node's predecessor. </P></DD><DT><CODE>new(succ:Succ)</CODE> </DT><DD><P>Issued when the node has a new successor node. <CODE><I>Succ</I></CODE> represents the node Id of the node's successor. </P></DD><DT><CODE>new(succlist:SuccList)</CODE> </DT><DD><P>Issued when there is a modification in the content of the node's successor list. <CODE><I>SuccList</I></CODE> has the form of a record with label <CODE>succlist</CODE>. The record contains the node Ids of the successors of this node. The maximum number of successors of a node is specified within <CODE>NetConfig</CODE> (see <A href="node2.html#section.p2ps.p2pservices">Section&nbsp;2.1</A>). The Id of a node may appear in its successor list if the network is smaller than the maximum size of the successor list. </P></DD></DL><P> </P></DD><DT><CODE>clientjoined</CODE> </DT><DD><P>Issued when a node is used as proxy by another node. This event has the form <CODE>clientjoined(NId)</CODE>, where <CODE><I>NId</I></CODE> represents the Id of the other node (i.e., the client). </P></DD><DT><CODE>clientleft</CODE> </DT><DD><P>Issued when a node using this node as proxy has disconnected from it. This event has the form <CODE>clientleft(NId)</CODE>, where <CODE><I>NId</I></CODE> represents the client's Id. </P></DD><DT><CODE>rejected</CODE> </DT><DD><P>Issued when the node has been rejected from the network because of a given reason. The event has the form <CODE>rejected(reason:Reason)</CODE>, where <CODE><I>Reason</I></CODE> is an atom giving the rejection reason. <CODE><I>Reason</I></CODE> takes the following values. <CODE>partiallyNotAccessible</CODE> when the node can not be accessible by both, its successor and predecessor. Note that the application can reconnect to the network, but it is suggested to chnage the node's Id. </P></DD><DT><CODE>openconn</CODE> </DT><DD><P>Issued when a reliable connection is opening to the other end. This event is generated at both nodes involved with the connection. It has the form <CODE>openconn(peerId:NId)</CODE> </P></DD><DT><CODE>closeconn</CODE> </DT><DD><P>Issued when a reliable connection was teared down. This event is generated at both nodes involved with the connection. The remaining non acked messages (each message paired with the corresponding <CODE>context</CODE>) are available in the list <CODE><I>RM</I></CODE>. It has the form <CODE>closeconn(peerId:NId&nbsp;rmnMsgs:RM)</CODE> </P></DD></DL><P> </P><P> </P></DIV></DIV><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node2.html#chapter.p2ps_api">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node4.html#chapter.examples">Next &gt;&gt;</A></TD></TR></TABLE><HR><ADDRESS>Bruno Carton and Valentin Mesaros<BR></ADDRESS></BODY></HTML>
