<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>2 GlobalStore Module Application Programming Interface</TITLE><LINK href="ozdoc.css" rel="stylesheet" type="text/css"></HEAD><BODY><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node1.html#chapter.introduction">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node3.html#chapter.examples">Next &gt;&gt;</A></TD></TR></TABLE><DIV id="chapter.api"><H1><A name="chapter.api">2 <CODE>GlobalStore</CODE> Module Application Programming Interface</A></H1><P> The interface functions to use the <CODE>GlobalStore</CODE> module are the followings: </P><DIV id="section.globalstore.newgs"><H2><A name="section.globalstore.newgs">2.1 Create a new global store (GS) and connect to it</A></H2><P> </P><DL><DT><A name="label1"></A><SPAN class="index"><CODE>GlobalStore<SPAN class="keyword">.</SPAN>new</CODE></SPAN> <A name="label2"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{GlobalStore<SPAN class="keyword">.</SPAN>new&nbsp;?GS}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>Creates a new global store GS where <CODE>GS</CODE> can be executed at any site using the following call: </P></DD><DT><A name="label3"></A><SPAN class="index"><CODE>newLocal</CODE></SPAN> <A name="label4"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{GS&nbsp;newLocal(Module&nbsp;UserName&nbsp;?UserId&nbsp;?NewObj&nbsp;?LocalStore&nbsp;?MoveHere)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>Creates a new LocalStore i.e. connect to Global Store. Each LocalStore can be used again by another site to connect to GlobalStore. </P><UL><LI><P>A local store is a single site's reference into the global store. </P></LI><LI><P>the <CODE>GS</CODE> and <CODE>newLocal</CODE> calls can be executed on any site. </P></LI><LI><P><CODE>Module</CODE> is the ressource Module Manager in the system. </P></LI><LI><P><CODE>UserName</CODE> is an atom or a string identifying a user. </P></LI><LI><P><CODE>UserId</CODE> is a unique identifier given to a user. </P></LI><LI><P><CODE>NewObj</CODE> is a sited reference; it can be executed only on the site on which it was created. Used to add a new object to the store. </P></LI><LI><P><CODE>LocalStore</CODE> is sited except for the <CODE>newLocal</CODE> method , which can be executed on any site. </P></LI><LI><P><CODE>MoveHere</CODE> is a non-sited reference; it can be executed on any site to move the server to that site. </P></LI><LI><P>The call <CODE>new</CODE> throws a <CODE>gs(failed_globalstore_creation)</CODE> exception when no global store is created. </P></LI><LI><P>A <CODE>LocalStore</CODE> created by one of these calls can itself create more LocalStores, and so forth recursively. That is, the creation of LocalStores is fully decenralized. </P></LI><LI><P>The call <CODE>newLocal</CODE> throws a <CODE>gs(connectionfailed)</CODE> exception if it fails to connect to the global store. </P></LI></UL><P> </P></DD></DL><P> </P></DIV><DIV id="section.globalstore.newobj"><H2><A name="section.globalstore.newobj">2.2 Create new objects in the GS</A></H2><P> </P><DL><DT><A name="label5"></A><SPAN class="index"><CODE>NewObj</CODE></SPAN> <A name="label6"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>O={NewObj&nbsp;Class&nbsp;Init}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>Add a new object <CODE>O</CODE> to the store. The call <CODE>NewObj</CODE> is synchronous. <CODE>O</CODE> is an object reference in the global store that is uniquely identified. The new object is immediately broadcasted to the other clients. Object can refrence to other object in the store. <CODE>Class</CODE> is any Oz class with the following restrictions: </P><UL><LI><P><CODE>getuniqueobjectid($)</CODE> method is defined by GlobalStore for any object from any class. This call returns Oz name. Example: </P><BLOCKQUOTE class="code"><CODE>X={O&nbsp;getuniqueobjectid($)}</CODE></BLOCKQUOTE><P> </P></LI><LI><P>no reference to resources e.g. file system, graphics interfece, objects that are not in GS, cells, variables, ports, etc. </P></LI></UL><P> </P></DD></DL><P> </P></DIV><DIV id="section.globalstore.object_query"><H2><A name="section.globalstore.object_query">2.3  Query single object</A></H2><P> </P><DL><DT><A name="label7"></A><SPAN class="index"><CODE>object_query</CODE></SPAN> <A name="label8"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{O&nbsp;Method}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>At any time without a transaction one can apply a read only method on <CODE>O</CODE> (a method that will not change object state). Applying a method that will change <CODE>O</CODE>'s state should be called inside a transaction. However, if rhe method invocation will change the object state, this does not change the object itself but affects its copy. </P></DD></DL><P> </P></DIV><DIV id="section.globalstore.trans"><H2><A name="section.globalstore.trans">2.4 Initiate a new transaction</A></H2><P>The user interacts with the global store by using transactions: </P><DL><DT><A name="label9"></A><SPAN class="index"><CODE>trans</CODE></SPAN> <A name="label10"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;trans(Trans&nbsp;?Out&nbsp;?Result)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>Initiates a transaction <CODE>Trans</CODE> which is a procedure of one argument.This call is asynchronous. The argument <CODE>Output</CODE> is a computed return value in <CODE>Trans</CODE>. The argument <CODE>Result</CODE> is initially unbound. It is bound to the atoms commit or abort. This argument will be bound as soon as global store determine the transaction state. A <CODE>gs(ill_formed_transaction)</CODE> exception is raised when <CODE>Trans</CODE> is not a one argument procedure. At a single user, execution of transactions are serialized. The procedure must have the following property: </P><UL><LI><P>Transactions have no external references to statful entities, such as objects that are not in GS, cells, variables and ports. </P></LI></UL><P> </P></DD></DL><P> </P><DIV id="section.globalstore.inside"><H3><A name="section.globalstore.inside">2.4.1 Calls inside transaction</A></H3><P>These functions can be called inside a transaction. </P><DL><DT><A name="label11"></A><SPAN class="index"><CODE>apply&nbsp;a&nbsp;method&nbsp;on&nbsp;an&nbsp;object</CODE></SPAN> <A name="label12"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{O&nbsp;Meth}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P><CODE>O</CODE> is a reference to an object in the store. </P></DD><DT><A name="label13"></A><SPAN class="index"><CODE>waitlocks</CODE></SPAN> <A name="label14"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;waitlocks(Objects)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>Wait for locks on <CODE>Objects</CODE>: if the locks are not obtained the transaction is aborted. </P></DD><DT><A name="label15"></A><SPAN class="index"><CODE>retrans</CODE> </SPAN> <A name="label16"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;retrans(Proc&nbsp;&nbsp;?Output&nbsp;?TranRes)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>The call <CODE>retrans</CODE> confirms all updates of the original (father) transaction that have already committed without waiting its end. The initial transaction result <CODE>Res</CODE> is mapped to a new transaction's result <CODE>TransRes</CODE>. Initially, the new transaction has the set of objects that its father has. </P></DD></DL><P> </P></DIV></DIV><DIV id="section.globalstore.deleteobj"><H2><A name="section.globalstore.deleteobj">2.5 Delete Object from GS</A></H2><P> The user can delete an object from GlobalStore by the following call </P><DL><DT><A name="label17"></A><SPAN class="index"><CODE>deleteobj</CODE></SPAN> <A name="label18"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;deleteobj(ObjRef&nbsp;?Res)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>This call will successfully delete an object from the store if it can obtain its lock. <CODE>Res</CODE> is initially unbound. It is bound to the atomes <CODE>commit</CODE>, <CODE>abort</CODE>. This call is synchronous. </P></DD></DL><P></P></DIV><DIV id="section.globalstore.disconnect"><H2><A name="section.globalstore.disconnect">2.6 Disconnect from GS</A></H2><P> The user can disconnect normally from GolbalStore by the following call </P><DL><DT><A name="label19"></A><SPAN class="index"><CODE>disconnect</CODE></SPAN> <A name="label20"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;disconnect(R)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>This call will successfully disconnect the caller from Globalstore if <CODE>R</CODE> equal to true. This call will change the current membership, and every member in GS will be notified about the latest membership. </P></DD></DL><P></P></DIV><DIV id="section.globalstore.migrate"><H2><A name="section.globalstore.migrate">2.7 Global Store migration</A></H2><P> GS can migrates by calling the <CODE>MoveHere</CODE> procedure. The <CODE>MoveHere</CODE> procedure is returned by the <CODE>newLocal</CODE> call. </P><DL><DT><A name="label21"></A><SPAN class="index"><CODE>MoveHere</CODE></SPAN> <A name="label22"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{MoveHere&nbsp;Module&nbsp;LocalStore&nbsp;Proc}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P>The call migrates the global store to the site where the one argument <CODE>MoveHere</CODE> procedure is executed. <CODE>LocalStore</CODE> is a returned sited reference to the store in the site where the call <CODE>MoveHere</CODE> is executed. <CODE>Module</CODE> is the ressource Module Manager in the system. <CODE>Proc</CODE> is a user defined zero argument procedure. <CODE>Proc</CODE> is executed at the site where the call <CODE>MoveHere</CODE> is executed. </P></DD></DL><P> </P></DIV><DIV id="section.globalstore.outside"><H2><A name="section.globalstore.outside">2.8 Notification procedures</A></H2><P> In order to communicate with user applications, the Golbal Store offers notify procedures of three kinds: </P><UL><LI><P>Membership (connection/disconnection) notification, to be executed if there is a user connected/disconnected to/from GS.</P></LI><LI><P>Object manipulation notification, to be executed if there are any object creation, update, or deletion. Creation procedures are called upon creation of a GS object. Update procedures are called whenever the state of a GS object is changed coherently. Delete procedures are called whenever a GS object is deleted. One Creation, Update, or Delete procedure can be installed per client and per object.</P></LI><LI><P>Recovery notification, to be executed when there is a recovery after server's failure. Every client must install this procedure at his site. </P></LI></UL><P> A Notify procedure installed by a client is executed only by that client on its site. Notify procedures must respect the following rules: </P><UL><LI><P>A Notify procedure can use in any way any language entity outside of the GS, e.g., resources, ports, cells, or objects that are not part of the GS. There are no restrictions. </P></LI><LI><P>A Notify procedure is given a coherent view of the GS, and it may call GS objects in any way. However, any changes done by these calls will be canceled after the Notify procedure exits. </P></LI><LI><P>The execution of a Notify procedure is serialized with transaction executions at a client. Therefore, the Notify procedure should not be too time-consuming, as this will delay the execution of transactions at that client. </P></LI><LI><P>A Notify procedure may initiate transactions, but it should not wait until a transaction completes. Otherwise, deadlock will occur. </P></LI></UL><P> </P><DL><DT><A name="label23"></A><SPAN class="index"><CODE>setnotifycreation</CODE></SPAN> <A name="label24"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;setnotifycreation(Proc)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P><CODE>Proc</CODE> is a user defined one argument procedure executed when another user creates a new object in the global store. <CODE>Proc</CODE> is executed on the local store. The argument of <CODE>Proc</CODE> is a reference to the new object in the store. a method that not change the object state could be called inside the notification to read the most recent state for the object. </P></DD><DT><A name="label25"></A><SPAN class="index"><CODE>setnotifyupdate</CODE></SPAN> <A name="label26"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;setnotifyupdate(Proc)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P><CODE>Proc</CODE> is a user defined one argument procedure executed when an object in the global store is updated by other users. <CODE>Proc</CODE> is executed on the local store. The argument of <CODE>Proc</CODE> is a reference to the updated GS object. This reference can be called with a method that will not change its state. </P></DD><DT><A name="label27"></A><SPAN class="index"><CODE>setnotifydelete</CODE></SPAN> <A name="label28"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;setnotifydelete(Proc)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P><CODE>Proc</CODE> is a user defined one argument procedure executed when an object in the global store is deleted by other users. <CODE>Proc</CODE> is executed on the local store. The argument of <CODE>Proc</CODE> is a reference to the deleted GS object. The object only be used temporarily inside the notification. </P></DD><DT><A name="label29"></A><SPAN class="index"><CODE>setnotifymembership</CODE></SPAN> <A name="label30"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;setnotifymembership(Proc)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P><CODE>Proc</CODE> is a user defined one argument procedure executed when there is a change in the membership (user connected, or disconnected). The argument of this Proc will be the list of current membership (<CODE>username1<SPAN class="keyword">#</SPAN>Id1</CODE>,...<CODE>username<SPAN class="keyword">#</SPAN>Idn</CODE>). Where Username1 is an atom or string issued by the user and Id is globally unique and neverchanges for a user. </P></DD><DT><A name="label31"></A><SPAN class="index"><CODE>setnotifyrecovery</CODE></SPAN> <A name="label32"></A> </DT><DD><BLOCKQUOTE class="synopsis"><P></P><BLOCKQUOTE class="code"><CODE>{LocalStore&nbsp;setnotifyrecovery(Proc)}</CODE></BLOCKQUOTE><P> </P></BLOCKQUOTE></DD><DD><P><CODE>Proc</CODE> is a user defined zero argument procedure executed when there is a recovery after server's failure and this is only executed at the new server site. To guarantee its execution upon recovery, every user must set this setnotify recovery. </P></DD></DL><P> </P></DIV></DIV><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node1.html#chapter.introduction">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node3.html#chapter.examples">Next &gt;&gt;</A></TD></TR></TABLE><HR><ADDRESS>Ilies Alouini, Mostafa AL-Metwally, Peter Van Roy<BR><SPAN class="version">Version 1.3.0 (20030218)</SPAN></ADDRESS></BODY></HTML>
